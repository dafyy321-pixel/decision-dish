# æ•°æ®åº“è¡¨ç»“æ„è¯¦ç»†è¯´æ˜

## ğŸ“‹ è¡¨æ¸…å•

| è¡¨å | ç±»å‹ | ç”¨é€” | æ‰€æœ‰è€… |
|------|------|------|--------|
| `users` | ç”¨æˆ·è¡¨ | å­˜å‚¨ç”¨æˆ·ä¿¡æ¯æ‰©å±• | ç”¨æˆ·ç‹¬ç«‹ |
| `restaurants` | é¤å…è¡¨ | å­˜å‚¨ç³»ç»Ÿå’Œç”¨æˆ·è‡ªå®šä¹‰é¤å… | ç³»ç»Ÿ/ç”¨æˆ· |
| `user_favorites` | æ”¶è—è¡¨ | å­˜å‚¨ç”¨æˆ·æ”¶è—çš„é¤å… | ç”¨æˆ·ç‹¬ç«‹ |
| `draw_history` | å†å²è®°å½•è¡¨ | å­˜å‚¨ç”¨æˆ·æŠ½å–å†å² | ç”¨æˆ·ç‹¬ç«‹ |
| `analytics_events` | äº‹ä»¶åˆ†æè¡¨ | è®°å½•ç”¨æˆ·è¡Œä¸ºäº‹ä»¶ | ç³»ç»Ÿ |
| `analytics_users` | ç”¨æˆ·åˆ†æè¡¨ | è®°å½•ç”¨æˆ·åˆ†ææ•°æ® | ç³»ç»Ÿ |
| `channel_stats` | æ¸ é“ç»Ÿè®¡è¡¨ | ç»Ÿè®¡ä¸åŒæ¸ é“çš„æ•°æ® | ç³»ç»Ÿ |
| `daily_uv` | æ—¥æ´»ç»Ÿè®¡è¡¨ | è®°å½•æ—¥æ´»è·ƒç”¨æˆ· | ç³»ç»Ÿ |
| `event_type_stats` | äº‹ä»¶ç±»å‹ç»Ÿè®¡è¡¨ | ç»Ÿè®¡å„ç±»å‹äº‹ä»¶ | ç³»ç»Ÿ |

---

## ğŸ“Š è¯¦ç»†è¡¨ç»“æ„

### 1ï¸âƒ£ **users** - ç”¨æˆ·ä¿¡æ¯è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·çš„æ‰©å±•ä¿¡æ¯ï¼Œä¸Supabase Authå…³è”

**å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| `id` | uuid | âœ… | (æ— ) | ä¸»é”®ï¼Œå¼•ç”¨auth.users |
| `username` | text | âŒ | NULL | ç”¨æˆ·å/æ˜µç§° |
| `avatar_url` | text | âŒ | NULL | å¤´åƒURL |
| `created_at` | timestamptz | âœ… | now() | åˆ›å»ºæ—¶é—´ |
| `updated_at` | timestamptz | âœ… | now() | æ›´æ–°æ—¶é—´ |

**çº¦æŸ**ï¼š
- ä¸»é”®ï¼š`id` (å¼•ç”¨ auth.users)
- è‡ªåŠ¨æ›´æ–°ï¼š`updated_at` ç”±è§¦å‘å™¨ç»´æŠ¤

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "username": "ç¾é£Ÿæ¢ç´¢è€…",
  "avatar_url": "https://example.com/avatar.jpg",
  "created_at": "2025-01-08T12:00:00Z",
  "updated_at": "2025-01-08T12:00:00Z"
}
```

---

### 2ï¸âƒ£ **restaurants** - é¤å…è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨ç³»ç»Ÿé¢„è®¾é¤å…å’Œç”¨æˆ·è‡ªå®šä¹‰é¤å…

**å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| `id` | uuid | âœ… | gen_random_uuid() | ä¸»é”® |
| `name` | text | âœ… | (æ— ) | é¤å…åç§° |
| `address` | text | âŒ | NULL | é¤å…åœ°å€ |
| `category` | text | âŒ | NULL | é¤å…åˆ†ç±»ï¼ˆä¸­é¤/æ—¥æ–™/ç«é”…ç­‰ï¼‰ |
| `image_url` | text | âŒ | NULL | é¤å…å›¾ç‰‡ |
| `rating` | numeric | âŒ | NULL | è¯„åˆ†ï¼ˆ1-5ï¼‰ |
| `price_level` | int | âŒ | NULL | ä»·æ ¼ç­‰çº§ï¼ˆ1-5ï¼‰ |
| `is_active` | boolean | âœ… | true | æ˜¯å¦å¯ç”¨ |
| `is_system` | boolean | âœ… | false | æ˜¯å¦ç³»ç»Ÿé¤å… |
| `user_id` | uuid | âŒ | NULL | æ‰€æœ‰è€…ç”¨æˆ·IDï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰ |
| `created_at` | timestamptz | âœ… | now() | åˆ›å»ºæ—¶é—´ |
| `updated_at` | timestamptz | âœ… | now() | æ›´æ–°æ—¶é—´ |

**çº¦æŸ**ï¼š
- ä¸»é”®ï¼š`id`
- å¤–é”®ï¼š`user_id` â†’ users.id (ON DELETE CASCADE)
- ç´¢å¼•ï¼š`(user_id)`, `(is_system)`, `(is_active)`

**RLSç­–ç•¥**ï¼š
- ç³»ç»Ÿé¤å…ï¼ˆ`is_system=true`ï¼‰å¯¹æ‰€æœ‰äººå¯è§
- ç”¨æˆ·é¤å…ï¼ˆ`is_system=false`ï¼‰ä»…æ‰€æœ‰è€…å¯è§

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "éº»è¾£çƒ«å°åº—",
  "address": "å­¦æ ¡é—¨å£ç¾é£Ÿè¡—12å·",
  "category": "éº»è¾£çƒ«",
  "image_url": "https://example.com/malataang.jpg",
  "rating": 4.5,
  "price_level": 1,
  "is_active": true,
  "is_system": true,
  "user_id": null,
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-01T00:00:00Z"
}
```

---

### 3ï¸âƒ£ **user_favorites** - æ”¶è—è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·æ”¶è—çš„é¤å…

**å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| `id` | uuid | âœ… | gen_random_uuid() | ä¸»é”® |
| `user_id` | uuid | âœ… | (æ— ) | ç”¨æˆ·ID |
| `restaurant_id` | uuid | âœ… | (æ— ) | é¤å…ID |
| `custom_name` | text | âŒ | NULL | è‡ªå®šä¹‰æ˜µç§° |
| `created_at` | timestamptz | âœ… | now() | æ”¶è—æ—¶é—´ |

**çº¦æŸ**ï¼š
- ä¸»é”®ï¼š`id`
- å¤–é”®ï¼š`user_id` â†’ users.id (ON DELETE CASCADE)
- å¤–é”®ï¼š`restaurant_id` â†’ restaurants.id (ON DELETE CASCADE)
- ç´¢å¼•ï¼š`(user_id)`, `(restaurant_id)`
- å”¯ä¸€çº¦æŸï¼š`(user_id, restaurant_id)` - åŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤æ”¶è—

**RLSç­–ç•¥**ï¼š
- ç”¨æˆ·ä»…èƒ½æŸ¥çœ‹/ä¿®æ”¹è‡ªå·±çš„æ”¶è—

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "id": "660e8400-e29b-41d4-a716-446655440001",
  "user_id": "123e4567-e89b-12d3-a456-426614174000",
  "restaurant_id": "550e8400-e29b-41d4-a716-446655440000",
  "custom_name": "æˆ‘çš„æœ€çˆ±",
  "created_at": "2025-01-08T10:30:00Z"
}
```

---

### 4ï¸âƒ£ **draw_history** - æŠ½å–å†å²è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·æ¯æ¬¡æŠ½å–çš„å†å²è®°å½•

**å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| `id` | uuid | âœ… | gen_random_uuid() | ä¸»é”® |
| `user_id` | uuid | âœ… | (æ— ) | ç”¨æˆ·ID |
| `restaurant_id` | uuid | âŒ | NULL | é¤å…IDï¼ˆå¯èƒ½å·²åˆ é™¤ï¼‰ |
| `restaurant_name` | text | âœ… | (æ— ) | é¤å…åç§°ï¼ˆå¿«ç…§ï¼‰ |
| `restaurant_address` | text | âŒ | NULL | é¤å…åœ°å€ï¼ˆå¿«ç…§ï¼‰ |
| `restaurant_category` | text | âŒ | NULL | é¤å…åˆ†ç±»ï¼ˆå¿«ç…§ï¼‰ |
| `drawn_at` | timestamptz | âœ… | now() | æŠ½å–æ—¶é—´ |

**çº¦æŸ**ï¼š
- ä¸»é”®ï¼š`id`
- å¤–é”®ï¼š`user_id` â†’ users.id (ON DELETE CASCADE)
- å¤–é”®ï¼š`restaurant_id` â†’ restaurants.id (ON DELETE SET NULL)
- ç´¢å¼•ï¼š`(user_id)`, `(drawn_at)` - ç”¨äºå¿«é€ŸæŸ¥è¯¢ç”¨æˆ·å†å²

**RLSç­–ç•¥**ï¼š
- ç”¨æˆ·ä»…èƒ½æŸ¥çœ‹è‡ªå·±çš„å†å²è®°å½•

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "id": "770e8400-e29b-41d4-a716-446655440002",
  "user_id": "123e4567-e89b-12d3-a456-426614174000",
  "restaurant_id": "550e8400-e29b-41d4-a716-446655440000",
  "restaurant_name": "éº»è¾£çƒ«å°åº—",
  "restaurant_address": "å­¦æ ¡é—¨å£ç¾é£Ÿè¡—12å·",
  "restaurant_category": "éº»è¾£çƒ«",
  "drawn_at": "2025-01-08T12:30:45Z"
}
```

---

### 5ï¸âƒ£ **analytics_events** - äº‹ä»¶åˆ†æè¡¨

**ç”¨é€”**ï¼šè®°å½•ç”¨æˆ·çš„æ‰€æœ‰äº¤äº’äº‹ä»¶ï¼ˆç”¨äºæ•°æ®åˆ†æï¼‰

**å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| `id` | uuid | âœ… | gen_random_uuid() | ä¸»é”® |
| `user_id` | uuid | âŒ | NULL | ç”¨æˆ·IDï¼ˆå¯èƒ½åŒ¿åï¼‰ |
| `event_type` | text | âœ… | (æ— ) | äº‹ä»¶ç±»å‹ï¼ˆdraw/collect/shareç­‰ï¼‰ |
| `event_name` | text | âœ… | (æ— ) | äº‹ä»¶åç§° |
| `event_data` | jsonb | âŒ | NULL | äº‹ä»¶æ•°æ®ï¼ˆçµæ´»å­—æ®µï¼‰ |
| `page_url` | text | âŒ | NULL | é¡µé¢URL |
| `user_agent` | text | âŒ | NULL | æµè§ˆå™¨ä¿¡æ¯ |
| `ip_address` | inet | âŒ | NULL | IPåœ°å€ |
| `created_at` | timestamptz | âœ… | now() | äº‹ä»¶æ—¶é—´ |

**çº¦æŸ**ï¼š
- ä¸»é”®ï¼š`id`
- å¤–é”®ï¼š`user_id` â†’ users.id (ON DELETE SET NULL)
- ç´¢å¼•ï¼š`(user_id)`, `(event_type)`, `(created_at)`

**äº‹ä»¶ç±»å‹**ï¼š
- `draw` - æŠ½å–
- `collect` - æ”¶è—
- `share` - åˆ†äº«
- `view_history` - æŸ¥çœ‹å†å²
- `page_view` - é¡µé¢æµè§ˆ

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "id": "880e8400-e29b-41d4-a716-446655440003",
  "user_id": "123e4567-e89b-12d3-a456-426614174000",
  "event_type": "draw",
  "event_name": "ç”¨æˆ·å®Œæˆä¸€æ¬¡æŠ½å–",
  "event_data": {
    "restaurant_id": "550e8400-e29b-41d4-a716-446655440000",
    "mode": "system"
  },
  "page_url": "https://yourdomain.com/",
  "user_agent": "Mozilla/5.0...",
  "ip_address": "192.168.1.1",
  "created_at": "2025-01-08T12:35:00Z"
}
```

---

### 6ï¸âƒ£ **analytics_users** - ç”¨æˆ·åˆ†æè¡¨

**ç”¨é€”**ï¼šæŒ‰å¤©ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„è¡Œä¸ºæ•°æ®

**å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| `id` | uuid | âœ… | gen_random_uuid() | ä¸»é”® |
| `user_id` | uuid | âŒ | NULL | ç”¨æˆ·ID |
| `date` | date | âœ… | CURRENT_DATE | ç»Ÿè®¡æ—¥æœŸ |
| `total_events` | int | âœ… | 0 | æ€»äº‹ä»¶æ•° |
| `draw_count` | int | âœ… | 0 | æŠ½å–æ¬¡æ•° |
| `collect_count` | int | âœ… | 0 | æ”¶è—æ¬¡æ•° |
| `share_count` | int | âœ… | 0 | åˆ†äº«æ¬¡æ•° |
| `session_duration` | int | âŒ | NULL | ä¼šè¯æ—¶é•¿ï¼ˆç§’ï¼‰ |
| `created_at` | timestamptz | âœ… | now() | åˆ›å»ºæ—¶é—´ |

**çº¦æŸ**ï¼š
- ä¸»é”®ï¼š`id`
- å”¯ä¸€çº¦æŸï¼š`(user_id, date)` - æ¯ä¸ªç”¨æˆ·æ¯å¤©ä¸€æ¡è®°å½•
- ç´¢å¼•ï¼š`(date)`, `(user_id)`

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "id": "990e8400-e29b-41d4-a716-446655440004",
  "user_id": "123e4567-e89b-12d3-a456-426614174000",
  "date": "2025-01-08",
  "total_events": 15,
  "draw_count": 5,
  "collect_count": 3,
  "share_count": 2,
  "session_duration": 1800,
  "created_at": "2025-01-08T23:59:59Z"
}
```

---

### 7ï¸âƒ£ **channel_stats** - æ¸ é“ç»Ÿè®¡è¡¨

**ç”¨é€”**ï¼šç»Ÿè®¡ä¸åŒæµé‡æ¥æº/æ¸ é“çš„æ•°æ®

**å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| `id` | uuid | âœ… | gen_random_uuid() | ä¸»é”® |
| `channel` | text | âœ… | (æ— ) | æ¸ é“åç§°ï¼ˆdirect/wechat/qq/shareç­‰ï¼‰ |
| `date` | date | âœ… | CURRENT_DATE | ç»Ÿè®¡æ—¥æœŸ |
| `uv` | int | âœ… | 0 | ç‹¬ç«‹è®¿å®¢æ•° |
| `pv` | int | âœ… | 0 | é¡µé¢æµè§ˆé‡ |
| `new_users` | int | âœ… | 0 | æ–°ç”¨æˆ·æ•° |
| `conversion_rate` | numeric | âŒ | NULL | è½¬åŒ–ç‡ |
| `created_at` | timestamptz | âœ… | now() | åˆ›å»ºæ—¶é—´ |

**çº¦æŸ**ï¼š
- ä¸»é”®ï¼š`id`
- å”¯ä¸€çº¦æŸï¼š`(channel, date)` - æ¯ä¸ªæ¸ é“æ¯å¤©ä¸€æ¡
- ç´¢å¼•ï¼š`(date)`, `(channel)`

**æ¸ é“ç±»å‹**ï¼š
- `direct` - ç›´æ¥è®¿é—®
- `wechat` - å¾®ä¿¡åˆ†äº«
- `qq` - QQåˆ†äº«
- `organic` - æœç´¢å¼•æ“

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "id": "aa0e8400-e29b-41d4-a716-446655440005",
  "channel": "wechat",
  "date": "2025-01-08",
  "uv": 156,
  "pv": 423,
  "new_users": 42,
  "conversion_rate": 0.27,
  "created_at": "2025-01-08T23:59:59Z"
}
```

---

### 8ï¸âƒ£ **daily_uv** - æ—¥æ´»ç»Ÿè®¡è¡¨

**ç”¨é€”**ï¼šè®°å½•æ¯å¤©çš„æ´»è·ƒç”¨æˆ·æ•°

**å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| `id` | uuid | âœ… | gen_random_uuid() | ä¸»é”® |
| `date` | date | âœ… | CURRENT_DATE | ç»Ÿè®¡æ—¥æœŸ |
| `uv` | int | âœ… | 0 | æ—¥æ´»è·ƒç”¨æˆ·æ•° |
| `new_users` | int | âœ… | 0 | æ–°å¢ç”¨æˆ·æ•° |
| `returning_users` | int | âœ… | 0 | å›è®¿ç”¨æˆ·æ•° |
| `total_events` | int | âœ… | 0 | æ€»äº‹ä»¶æ•° |
| `avg_session_duration` | numeric | âŒ | NULL | å¹³å‡ä¼šè¯æ—¶é•¿ |
| `created_at` | timestamptz | âœ… | now() | åˆ›å»ºæ—¶é—´ |

**çº¦æŸ**ï¼š
- ä¸»é”®ï¼š`id`
- å”¯ä¸€çº¦æŸï¼š`(date)` - æ¯å¤©ä¸€æ¡è®°å½•
- ç´¢å¼•ï¼š`(date)`

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "id": "bb0e8400-e29b-41d4-a716-446655440006",
  "date": "2025-01-08",
  "uv": 2345,
  "new_users": 234,
  "returning_users": 2111,
  "total_events": 45678,
  "avg_session_duration": 450.5,
  "created_at": "2025-01-08T23:59:59Z"
}
```

---

### 9ï¸âƒ£ **event_type_stats** - äº‹ä»¶ç±»å‹ç»Ÿè®¡è¡¨

**ç”¨é€”**ï¼šæŒ‰äº‹ä»¶ç±»å‹ç»Ÿè®¡èšåˆæ•°æ®

**å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|-------|------|------|--------|------|
| `id` | uuid | âœ… | gen_random_uuid() | ä¸»é”® |
| `event_type` | text | âœ… | (æ— ) | äº‹ä»¶ç±»å‹ |
| `date` | date | âœ… | CURRENT_DATE | ç»Ÿè®¡æ—¥æœŸ |
| `count` | int | âœ… | 0 | äº‹ä»¶å‘ç”Ÿæ¬¡æ•° |
| `unique_users` | int | âœ… | 0 | å‚ä¸è¯¥äº‹ä»¶çš„ç‹¬ç«‹ç”¨æˆ·æ•° |
| `pct_of_total` | numeric | âŒ | NULL | å æ€»äº‹ä»¶çš„ç™¾åˆ†æ¯” |
| `created_at` | timestamptz | âœ… | now() | åˆ›å»ºæ—¶é—´ |

**çº¦æŸ**ï¼š
- ä¸»é”®ï¼š`id`
- å”¯ä¸€çº¦æŸï¼š`(event_type, date)` - æ¯ä¸ªäº‹ä»¶ç±»å‹æ¯å¤©ä¸€æ¡
- ç´¢å¼•ï¼š`(date)`, `(event_type)`

**ç¤ºä¾‹æ•°æ®**ï¼š
```json
{
  "id": "cc0e8400-e29b-41d4-a716-446655440007",
  "event_type": "draw",
  "date": "2025-01-08",
  "count": 12345,
  "unique_users": 3456,
  "pct_of_total": 0.27,
  "created_at": "2025-01-08T23:59:59Z"
}
```

---

## ğŸ”— è¡¨å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   auth.users (ç³»ç»Ÿè¡¨)    â”‚
â”‚   (Supabaseå†…ç½®)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ id
             â”‚ (å¤–é”®)
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  users (ç”¨æˆ·æ‰©å±•)  â”‚
    â”‚  - id (PK)         â”‚
    â”‚  - username        â”‚
    â”‚  - avatar_url      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ id
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                         â”‚
             â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  restaurants        â”‚  â”‚  user_favorites      â”‚
    â”‚  - id (PK)          â”‚  â”‚  - id (PK)           â”‚
    â”‚  - name             â”‚  â”‚  - user_id (FK)      â”‚
    â”‚  - is_system        â”‚  â”‚  - restaurant_id (FK)â”‚
    â”‚  - user_id (FK)     â”‚â—€â”€â”¤  - created_at        â”‚
    â”‚  - category         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  - rating           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ id
             â”‚ (å¤–é”®)
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  draw_history       â”‚
    â”‚  - id (PK)          â”‚
    â”‚  - user_id (FK)     â”‚
    â”‚  - restaurant_id(FK)â”‚
    â”‚  - drawn_at         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†ææ•°æ®ï¼ˆä¸ç›´æ¥å…³è”ä¸šåŠ¡è¡¨ï¼‰:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  analytics_events  â”‚
    â”‚  - event_type      â”‚
    â”‚  - user_id (FK)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  analytics_users   â”‚
    â”‚  - user_id (FK)    â”‚
    â”‚  - date            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  channel_stats     â”‚
    â”‚  - channel         â”‚
    â”‚  - date            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  daily_uv          â”‚
    â”‚  - date            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ event_type_stats   â”‚
    â”‚  - event_type      â”‚
    â”‚  - date            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ æ•°æ®éš”ç¦»ä¸å®‰å…¨

### RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰ç­–ç•¥

| è¡¨ | è¯»(SELECT) | å†™(INSERT) | æ”¹(UPDATE) | åˆ (DELETE) |
|----|-----------|-----------|-----------|-----------|
| users | ä»…è‡ªå·± | âœ… | ä»…è‡ªå·± | âŒ |
| restaurants | ç³»ç»Ÿ/è‡ªå·± | ä»…è‡ªå·± | ä»…è‡ªå·± | ä»…è‡ªå·± |
| user_favorites | ä»…è‡ªå·± | ä»…è‡ªå·± | âŒ | ä»…è‡ªå·± |
| draw_history | ä»…è‡ªå·± | ä»…è‡ªå·± | âŒ | ä»…è‡ªå·± |
| analytics_* | æ‰€æœ‰äººè¯» | ç³»ç»Ÿå†™ | âŒ | âŒ |

---

## ğŸ“ˆ æŸ¥è¯¢ç¤ºä¾‹

### è·å–ç”¨æˆ·çš„æ”¶è—é¤å…

```sql
SELECT r.* 
FROM restaurants r
JOIN user_favorites uf ON r.id = uf.restaurant_id
WHERE uf.user_id = 'user-id-here'
ORDER BY uf.created_at DESC;
```

### è·å–ç”¨æˆ·çš„æŠ½å–å†å²ï¼ˆæœ€è¿‘10æ¬¡ï¼‰

```sql
SELECT * 
FROM draw_history 
WHERE user_id = 'user-id-here'
ORDER BY drawn_at DESC 
LIMIT 10;
```

### è·å–ä»Šæ—¥æ´»è·ƒç”¨æˆ·æ•°

```sql
SELECT uv 
FROM daily_uv 
WHERE date = CURRENT_DATE;
```

### æŒ‰äº‹ä»¶ç±»å‹ç»Ÿè®¡ä»Šæ—¥æ•°æ®

```sql
SELECT event_type, count, unique_users
FROM event_type_stats
WHERE date = CURRENT_DATE
ORDER BY count DESC;
```

---

## ğŸ¯ æ€»ç»“

| è¡¨åˆ†ç±» | è¡¨å | è¯´æ˜ |
|-------|------|------|
| **ä¸šåŠ¡æ ¸å¿ƒ** | users | ç”¨æˆ·ä¿¡æ¯ |
| | restaurants | é¤å…æ•°æ® |
| | user_favorites | ç”¨æˆ·æ”¶è— |
| | draw_history | æŠ½å–å†å² |
| **æ•°æ®åˆ†æ** | analytics_events | äº‹ä»¶è®°å½• |
| | analytics_users | ç”¨æˆ·åˆ†æ |
| | channel_stats | æ¸ é“åˆ†æ |
| | daily_uv | æ—¥æ´»ç»Ÿè®¡ |
| | event_type_stats | äº‹ä»¶ç»Ÿè®¡ |

- **å‰4ä¸ªè¡¨**æ˜¯åº”ç”¨æ ¸å¿ƒä¸šåŠ¡è¡¨ï¼Œæ”¯æŒRLSå®ç°æ•°æ®éš”ç¦»
- **å5ä¸ªè¡¨**æ˜¯åˆ†æè¡¨ï¼Œç”¨äºBIå’Œæ•°æ®ç»Ÿè®¡ï¼Œç³»ç»Ÿå†™å…¥ã€æ‰€æœ‰äººå¯è¯»
